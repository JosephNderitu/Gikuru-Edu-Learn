<!-- notes/templates/notes/books/add_book.html -->
{% extends 'core/base_with_sidebar.html' %}
{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-purple-50 py-8 px-4">
    <div class="max-w-4xl mx-auto">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                <i class="fas fa-book-medical text-white text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Add New Book</h1>
            <p class="text-gray-600">Add a book with APA7 citation details</p>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
            <!-- Form Header -->
            <div class="bg-gradient-to-r from-purple-600 to-indigo-700 px-6 py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-plus text-white text-lg"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-white">Book Information</h2>
                        <p class="text-purple-100 text-sm">Fill in the book details</p>
                    </div>
                </div>
            </div>

            <!-- Form Content -->
            <form method="POST" enctype="multipart/form-data" class="p-6 space-y-6">
                {% csrf_token %}
                
                <!-- Basic Information -->
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-gray-700 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                        <span>Basic Information</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Title -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Title <span class="text-red-500">*</span>
                            </label>
                            {{ form.title }}
                            {% if form.title.errors %}
                            <div class="text-red-600 text-xs">{{ form.title.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Subtitle -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Subtitle (Optional)
                            </label>
                            {{ form.subtitle }}
                        </div>
                    </div>

                    <!-- Subject -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Course Subject <span class="text-red-500">*</span>
                        </label>
                        {{ form.subject }}
                        {% if form.subject.errors %}
                        <div class="text-red-600 text-xs">{{ form.subject.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Description
                        </label>
                        {{ form.description }}
                    </div>
                </div>

                <!-- Author Information -->
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-gray-700 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                        <span>Author Information (APA7 Format)</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Author First Name -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Author First Name <span class="text-red-500">*</span>
                            </label>
                            {{ form.author_first_name }}
                            {% if form.author_first_name.errors %}
                            <div class="text-red-600 text-xs">{{ form.author_first_name.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Author Last Name -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Author Last Name <span class="text-red-500">*</span>
                            </label>
                            {{ form.author_last_name }}
                            {% if form.author_last_name.errors %}
                            <div class="text-red-600 text-xs">{{ form.author_last_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Additional Authors -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Additional Authors (Optional)
                        </label>
                        {{ form.additional_authors }}
                        <p class="text-xs text-gray-500">Format: Lastname, F. (e.g., Smith, J. or Doe, J., Johnson, K.)</p>
                    </div>
                </div>

                <!-- Publication Details -->
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-gray-700 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <span>Publication Details</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Publication Year -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Publication Year <span class="text-red-500">*</span>
                            </label>
                            {{ form.publication_year }}
                            {% if form.publication_year.errors %}
                            <div class="text-red-600 text-xs">{{ form.publication_year.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Edition -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Edition
                            </label>
                            {{ form.edition }}
                        </div>

                        <!-- Publisher -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Publisher <span class="text-red-500">*</span>
                            </label>
                            {{ form.publisher }}
                            {% if form.publisher.errors %}
                            <div class="text-red-600 text-xs">{{ form.publisher.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Identifiers -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- ISBN -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                ISBN (Optional)
                            </label>
                            {{ form.isbn }}
                            <p class="text-xs text-gray-500">10 or 13 digits</p>
                        </div>

                        <!-- URL -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                URL (Optional)
                            </label>
                            {{ form.url }}
                        </div>
                    </div>
                </div>

                <!-- Files -->
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-gray-700 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                        <span>Files</span>
                    </h3>
                    
                    <!-- Cover Image -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Cover Image (Optional)
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-purple-400 transition bg-white">
                            {{ form.cover_image }}
                            <div class="text-center">
                                <i class="fas fa-image text-gray-400 text-xl mb-2"></i>
                                <p class="text-sm text-gray-600">Click to upload cover image</p>
                                <p class="text-xs text-gray-500">JPG, PNG (Max 5MB)</p>
                            </div>
                        </div>
                    </div>

                    <!-- PDF File -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            PDF File <span class="text-red-500">*</span>
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-red-400 transition bg-white">
                            {{ form.pdf_file }}
                            <div class="text-center">
                                <i class="fas fa-file-pdf text-red-400 text-xl mb-2"></i>
                                <p class="text-sm text-gray-600">Click to upload PDF</p>
                                <p class="text-xs text-gray-500">PDF files only (Max 50MB)</p>
                            </div>
                        </div>
                        {% if form.pdf_file.errors %}
                        <div class="text-red-600 text-xs">{{ form.pdf_file.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Additional Details -->
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-gray-700 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                        <span>Additional Details</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Pages -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Number of Pages
                            </label>
                            {{ form.pages }}
                        </div>

                        <!-- Language -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Language
                            </label>
                            {{ form.language }}
                        </div>

                        <!-- Required -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">
                                Book Status
                            </label>
                            <div class="flex items-center space-x-2 mt-2">
                                {{ form.is_required }}
                                <span class="text-sm text-gray-700">Required Reading</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Citation -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                        <div class="text-sm text-blue-700">
                            <p class="font-medium">APA7 Citation Preview:</p>
                            <p id="citation-preview" class="italic mt-1">
                                Citation will appear here after you fill the form...
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex space-x-3 pt-6 border-t border-gray-200">
                    <button type="submit" 
                            class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg flex items-center justify-center space-x-2">
                        <i class="fas fa-save"></i>
                        <span>Add Book</span>
                    </button>
                    <a href="{% url 'book_list' %}" 
                       class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center justify-center">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Citation preview
    function updateCitationPreview() {
        const authorLastName = document.querySelector('[name="author_last_name"]')?.value || '';
        const authorFirstName = document.querySelector('[name="author_first_name"]')?.value || '';
        const publicationYear = document.querySelector('[name="publication_year"]')?.value || '';
        const title = document.querySelector('[name="title"]')?.value || '';
        const subtitle = document.querySelector('[name="subtitle"]')?.value || '';
        const edition = document.querySelector('[name="edition"]')?.value || '1';
        const publisher = document.querySelector('[name="publisher"]')?.value || '';
        
        if (authorLastName && authorFirstName && publicationYear && title && publisher) {
            const authorInitial = authorFirstName[0] || '';
            let authorString = `${authorLastName}, ${authorInitial}.`;
            
            let titleString = title;
            if (subtitle) {
                titleString += `: ${subtitle}`;
            }
            
            let editionString = '';
            if (edition && edition !== '1') {
                if (edition === '2') editionString = ' (2nd ed.)';
                else if (edition === '3') editionString = ' (3rd ed.)';
                else editionString = ` (${edition}th ed.)`;
            }
            
            const citation = `${authorString} (${publicationYear}). <em>${titleString}</em>${editionString}. ${publisher}.`;
            document.getElementById('citation-preview').innerHTML = citation;
        }
    }

    // Update citation when form fields change
    document.addEventListener('DOMContentLoaded', function() {
        const formFields = ['author_last_name', 'author_first_name', 'publication_year', 
                        'title', 'subtitle', 'edition', 'publisher'];
        
        formFields.forEach(fieldName => {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.addEventListener('input', updateCitationPreview);
                field.addEventListener('change', updateCitationPreview);
            }
        });
        
        // Initial update
        updateCitationPreview();
    });
</script>

<style>
/* Custom styling for form fields */
input, select, textarea {
    @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors;
}

/* Hide default file input */
input[type="file"] {
    @apply absolute inset-0 w-full h-full opacity-0 cursor-pointer;
}

/* Style for checkboxes */
input[type="checkbox"] {
    @apply w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500;
}
</style>
{% endblock %}